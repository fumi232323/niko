<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Django なんでもメモ/ふみのて</title>
<link rel="shortcut icon" href="../../assets/icons/favicon.ico">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link rel="stylesheet" href="../../assets/css/style.css?20190614">
</head>
<body>
    <div class="container">
      <div class="header"><header class="item item-header"><h1>
    <a href="../../">
      <img class="logo" src="../../assets/images/inuu.png" alt="犬"></a>
  </h1>
  <nav class="nav"><ul>
<li class="nav-category"><a href="../../">HOME</a></li>
    </ul></nav><iframe src="../../tags/" class="tags-frame"></iframe>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-django"><time class="date" datetime="2018-10-28 00:00:00+09:00">
      2018-10-28 Sun
    </time><div class="title">Django なんでもメモ</div>
    <div class="category">
      <a href="../../tags/django/">
          django
      </a>
    </div>
    <div class="text">
      <div>
<details><summary>目次</summary><div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id6">マイグレーションを間違えたときのリカバリ方法</a></li>
<li>
<a class="reference internal" href="#id3" id="id7">こんなのある</a><ul>
<li><a class="reference internal" href="#multivaluedict" id="id8">MultiValueDict</a></li>
<li><a class="reference internal" href="#querydict" id="id9">QueryDict オブジェクト</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#id5" id="id10">便利さん</a><ul>
<li><a class="reference internal" href="#django" id="id11">django に便利コマンド追加してくれるさん</a></li>
</ul>
</li>
</ul>
</div>
</details><div class="section" id="id2">
<h2><a class="toc-backref" href="#id6">マイグレーションを間違えたときのリカバリ方法</a></h2>
<ol class="arabic">
<li>
<p class="first">DjangoのDBシェルでローカルDBにつなぐ</p>
<blockquote>
<pre class="code console"><a name="rest_code_344e95ad8b7041f8b0a9115c828a08a5-1"></a><span class="gp">$</span> python manage.py dbshell --settings<span class="o">=</span>settings.local
</pre>
</blockquote>
</li>
<li>
<p class="first">django_migrations テーブルから該当アプリのレコードを削除する</p>
<blockquote>
<pre class="code sql"><a name="rest_code_50a46976b0a946a0a4689008eaad3c67-1"></a><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">django_migrations</span> <span class="k">WHERE</span> <span class="n">app</span> <span class="k">like</span> <span class="s1">'%{application_name}%'</span><span class="p">;</span>
<a name="rest_code_50a46976b0a946a0a4689008eaad3c67-2"></a><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">django_migrations</span> <span class="k">WHERE</span> <span class="n">id</span><span class="o">=</span><span class="err">{該当の</span><span class="n">ID</span><span class="err">}</span><span class="p">;</span>
</pre>
</blockquote>
</li>
<li>
<p class="first">該当テーブルやカラムも DROP する</p>
<blockquote>
<pre class="code sql"><a name="rest_code_0de6d1c5823b404fb7e697b0e8c531dd-1"></a><span class="k">DROP</span> <span class="k">TABLE</span> <span class="err">{</span><span class="k">table_name</span><span class="err">}</span><span class="p">;</span>
<a name="rest_code_0de6d1c5823b404fb7e697b0e8c531dd-2"></a><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="err">{</span><span class="k">table_name</span><span class="err">}</span> <span class="k">DROP</span> <span class="k">COLUMN</span> <span class="err">{</span><span class="k">column_name</span><span class="err">}</span><span class="p">;</span>
</pre>
</blockquote>
</li>
<li>
<p class="first">該当のマイグレーションファイルも削除しておく</p>
</li>
<li>
<p class="first">もう一回最初からマイグレーションする</p>
<blockquote>
<pre class="code console"><a name="rest_code_b03dcfdf64e64410ae7fb1822be246ac-1"></a><span class="gp">$</span> python manage.py makemigrations <span class="o">{</span>application_name<span class="o">}</span> --settings<span class="o">=</span>settings.local
<a name="rest_code_b03dcfdf64e64410ae7fb1822be246ac-2"></a><span class="gp">$</span> python manage.py migrate <span class="o">{</span>application_name<span class="o">}</span> --settings<span class="o">=</span>settings.local
</pre>
</blockquote>
</li>
</ol>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id7">こんなのある</a></h2>
<div class="section" id="multivaluedict">
<h3><a class="toc-backref" href="#id8">MultiValueDict</a></h3>
<p>なにがうれしいのかさっぱりわからない =&gt; <cite>MultiValueDict を継承してる QueryDict とか見るとユースケースはなんとなく想像つくと思います</cite> と教えて頂いた。</p>
<ul>
<li>
<p class="first"><a class="reference external" href="https://docs.djangoproject.com/ja/2.1/_modules/django/utils/datastructures/">https://docs.djangoproject.com/ja/2.1/_modules/django/utils/datastructures/</a></p>
<pre class="literal-block">
A subclass of dictionary customized to handle multiple values for the same key.
</pre>
</li>
<li>
<p class="first">よく見たら、こういうところが便利だと思った ↓</p>
<pre class="code python"><a name="rest_code_c026a6e62767438f905e4379c10d1dc1-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">django.utils.datastructures</span> <span class="kn">import</span> <span class="n">MultiValueDict</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="n">MultiValueDict</span><span class="p">({</span><span class="s1">'name'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Adrian'</span><span class="p">,</span> <span class="s1">'Simon'</span><span class="p">],</span> <span class="s1">'position'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Developer'</span><span class="p">]})</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-3"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Momo'</span><span class="p">})</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">d</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-5"></a><span class="o">&lt;</span><span class="n">MultiValueDict</span><span class="p">:</span> <span class="p">{</span><span class="s1">'position'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Developer'</span><span class="p">],</span> <span class="s1">'name'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Adrian'</span><span class="p">,</span> <span class="s1">'Simon'</span><span class="p">,</span> <span class="s1">'Momo'</span><span class="p">]}</span><span class="o">&gt;</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-6"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">dd</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'name'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Adrian'</span><span class="p">,</span> <span class="s1">'Simon'</span><span class="p">],</span> <span class="s1">'position'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Developer'</span><span class="p">]}</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-7"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">dd</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Momo'</span><span class="p">})</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-8"></a><span class="o">&gt;&gt;&gt;</span> <span class="n">dd</span>
<a name="rest_code_c026a6e62767438f905e4379c10d1dc1-9"></a><span class="p">{</span><span class="s1">'position'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'Developer'</span><span class="p">],</span> <span class="s1">'name'</span><span class="p">:</span> <span class="s1">'Momo'</span><span class="p">}</span>
</pre>
</li>
</ul>
</div>
<div class="section" id="querydict">
<h3><a class="toc-backref" href="#id9">QueryDict オブジェクト</a></h3>
<p><cite>In an HttpRequest object, the GET and POST attributes are instances of django.http.QueryDict</cite> だそうです。</p>
<blockquote>
<ul>
<li>
<p class="first"><a class="reference external" href="https://docs.djangoproject.com/ja/2.1/ref/request-response/#querydict-objects">QueryDict オブジェクト</a></p>
<pre class="literal-block">
In an HttpRequest object, the GET and POST attributes are instances of django.http.QueryDict, a dictionary-like class customized to deal with multiple values for the same key. This is necessary because some HTML form elements, notably &lt;select multiple&gt;, pass multiple values for the same key.
</pre>
</li>
</ul>
</blockquote>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id10">便利さん</a></h2>
<div class="section" id="django">
<h3><a class="toc-backref" href="#id11">django に便利コマンド追加してくれるさん</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://django-extensions.readthedocs.io/en/latest/">django-extensions</a></li>
</ul>
</div>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>
</html>
