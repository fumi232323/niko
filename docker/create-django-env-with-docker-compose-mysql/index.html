<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Docker Compose で Django/MySQL 環境をつくる/ふみのて</title>
<link rel="shortcut icon" href="../../assets/icons/favicon.ico">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link rel="stylesheet" href="../../assets/css/style.css?20190602">
</head>
<body>
    <div class="container">
      <div class="header"><header class="item item-header"><h1>
    <a href="../../">
      <img class="logo" src="../../assets/images/inuu.png" alt="犬"></a>
  </h1>
  <nav class="nav"><ul>
<li class="nav-category"><a href="../../">HOME</a></li>
    </ul></nav><iframe src="../../tags/" class="tags-frame"></iframe>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-docker"><time class="date" datetime="2019-01-05 00:00:00+09:00">
      2019-01-05 Sat
    </time><div class="title">Docker Compose で Django/MySQL 環境をつくる</div>
    <div class="category">
      <a href="../../tags/docker/">
          docker
      </a>
    </div>
    <div class="text">
      <div>
<details><summary>目次</summary><div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id12">リファレンス・ガイド</a></li>
<li>
<a class="reference internal" href="#id3" id="id13">環境構築</a><ul>
<li><a class="reference internal" href="#id4" id="id14">最初の1回だけ実行</a></li>
<li><a class="reference internal" href="#id5" id="id15">2回目以降</a></li>
<li><a class="reference internal" href="#id6" id="id16">ディレクトリ構成</a></li>
<li><a class="reference internal" href="#id7" id="id17">設定ファイル</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#id8" id="id18">使い方メモ</a><ul>
<li><a class="reference internal" href="#id9" id="id19">イメージビルドからやり直したい</a></li>
<li><a class="reference internal" href="#volume" id="id20">volume は消さない限り再利用される</a></li>
<li><a class="reference internal" href="#web" id="id21">web のほうのコンテナだけ再起動したいとき</a></li>
<li><a class="reference internal" href="#id10" id="id22">web のほうのコンテナに入る</a></li>
<li><a class="reference internal" href="#mysql" id="id23">mysql のほうのコンテナに入る</a></li>
<li><a class="reference internal" href="#id11" id="id24">mysql に入る</a></li>
</ul>
</li>
<li><a class="reference internal" href="#todo" id="id25">TODO</a></li>
</ul>
</div>
</details><div class="section" id="id2">
<h2><a class="toc-backref" href="#id12">リファレンス・ガイド</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.docker.com/compose/compose-file/">Compose file version 3 reference</a></li>
<li>
<a class="reference external" href="https://hub.docker.com/_/mysql/">Docker Hub の MySQL 公式イメージぺージ</a><ul>
<li>
<tt class="docutils literal"><span class="pre">docker-compose</span></tt> ファイルの書き方見本とか、 Environment Variables の一覧とかが載っていた</li>
</ul>
</li>
<li>
<a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/">MySQL 8.0 Reference Manual</a><ul>
<li>MySQL 自体のリファレンス</li>
<li>
<a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/environment-variables.html">MySQL Program Environment Variables</a> :
<tt class="docutils literal"><span class="pre">docker-compose</span></tt> ファイルの <tt class="docutils literal">environment</tt> 部分に書けるやつを探すときに使った</li>
<li>
<a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/server-options.html">Server Command Options</a> :
<tt class="docutils literal">mysql.cnf</tt> に書けるやつ、 <tt class="docutils literal"><span class="pre">docker-compose</span></tt> ファイルの <tt class="docutils literal">command</tt> 部分に書けるやつを探すときに使った</li>
<li>
<a class="reference external" href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html">Server System Variables</a> :
<tt class="docutils literal">mysql.cnf</tt> に書けるやつを探すときに使った</li>
</ul>
</li>
<li>
<a class="reference external" href="https://pypi.org/project/mysql-connector-python/">PyPI の mysql-connector-python のページ</a><ul>
<li>MySQL の driver。これが Oracle 純正のものらしい。</li>
</ul>
</li>
<li>
<a class="reference external" href="https://dev.mysql.com/doc/connector-python/en/">MySQL Connector/Python Developer Guide</a><ul>
<li>mysql-connector-python のガイドページ。使い方や見本がいろいろ載っている。</li>
</ul>
</li>
<li><a class="reference external" href="https://pypi.org/project/mysqlclient/">PyPI の mysqlclient のページ</a></li>
<li>
<a class="reference external" href="https://docs.djangoproject.com/ja/2.1/ref/databases/#mysql-notes">Django で MySQL を使うときは見てねページ</a><ul>
<li>Django のほうの説明を読んだら、 <tt class="docutils literal">mysqlclient</tt> がおすすめ、かつ、 <cite>Django requires mysqlclient 1.3.7 or later.</cite> と書いてある。</li>
<li>とりあえず <tt class="docutils literal">mysqlclient</tt> と <tt class="docutils literal"><span class="pre">mysql-connector-python</span></tt> を両方入れてみる。</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id13">環境構築</a></h2>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id14">最初の1回だけ実行</a></h3>
<ol class="arabic">
<li>
<p class="first">web・db の docker image をビルド -&gt; web で startproject する。</p>
<blockquote>
<pre class="code bash"><a name="rest_code_1cb23970eb29432797921a112dca8168-1"></a>$ docker-compose --pull<span class="o">=</span><span class="nb">true</span> run web django-admin.py startproject fu .
</pre>
<ul class="simple">
<li>
<tt class="docutils literal"><span class="pre">--pull=true</span></tt> : FROM に指定したベースイメージがローカルにすでに存在していても、改めて Docker Hub に取得しにいく</li>
<li>↑今やったら使えなかった。最新イメージを再取得するには、どうすればいいんだろう。</li>
</ul>
</blockquote>
</li>
<li>
<p class="first">settings に MySQL の設定を書き足す</p>
<blockquote>
<pre class="code python"><a name="rest_code_3b57aded265d439b846c8d58b5a09635-1"></a><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-2"></a>    <span class="s1">'default'</span><span class="p">:</span> <span class="p">{</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-3"></a>        <span class="s1">'ENGINE'</span><span class="p">:</span> <span class="s1">'django.db.backends.mysql'</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-4"></a>        <span class="s1">'NAME'</span><span class="p">:</span> <span class="s1">'fu'</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-5"></a>        <span class="s1">'USER'</span><span class="p">:</span> <span class="s1">'fu'</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-6"></a>        <span class="s1">'PASSWORD'</span><span class="p">:</span> <span class="s1">'fu'</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-7"></a>        <span class="s1">'HOST'</span><span class="p">:</span> <span class="s1">'db'</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-8"></a>        <span class="s1">'PORT'</span><span class="p">:</span> <span class="mi">3306</span><span class="p">,</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-9"></a>    <span class="p">}</span>
<a name="rest_code_3b57aded265d439b846c8d58b5a09635-10"></a><span class="p">}</span>
</pre>
</blockquote>
</li>
<li>
<p class="first">docker-compose up して、 web・db コンテナを起動する</p>
<blockquote>
<pre class="code bash"><a name="rest_code_399f7fefa76e48e0a7450bba44d95d38-1"></a>$ docker-compose up
</pre>
</blockquote>
</li>
</ol>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id15">2回目以降</a></h3>
<ol class="arabic">
<li>
<p class="first">docker-compose up して mysql・web コンテナを起動する。</p>
<blockquote>
<pre class="code bash"><a name="rest_code_81bce5382cad40c5ba17e5c424431a80-1"></a>$ docker-compose up
</pre>
</blockquote>
</li>
<li>
<p class="first">安全にシャットダウン。コンテナの停止と削除。</p>
<blockquote>
<pre class="code bash"><a name="rest_code_8cbc4a483d01403caca9a4d0546e0e17-1"></a>$ docker-compose down
</pre>
</blockquote>
</li>
</ol>
</div>
<div class="section" id="id6">
<span id="config-files"></span><h3><a class="toc-backref" href="#id16">ディレクトリ構成</a></h3>
<pre class="code shell"><a name="rest_code_084fea8587f14f10a15a72c703128ea2-1"></a>$ tree fu
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-2"></a>
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-3"></a>fu
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-4"></a>├── Dockerfile-mysql
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-5"></a>├── Dockerfile-web
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-6"></a>├── docker-compose.yml
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-7"></a>├── fu
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-8"></a>│   ├── __init__.py
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-9"></a>│   ├── urls.py
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-10"></a>│   └── wsgi.py
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-11"></a>├── manage.py
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-12"></a>├── mysql
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-13"></a>│   └── conf.d
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-14"></a>│       └── mysql.cnf
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-15"></a>├── requirements.txt
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-16"></a>└── settings
<a name="rest_code_084fea8587f14f10a15a72c703128ea2-17"></a>    └── _.py
</pre>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#id17">設定ファイル</a></h3>
<ul>
<li>
<p class="first">fu/docker-compose.yml</p>
<p></p>
<div class="code-block ">
<div class="highlight"><pre><span></span><span class="nt">version</span><span class="p">:</span> <span class="s">'3'</span>

<span class="nt">services</span><span class="p">:</span>
  <span class="nt">db</span><span class="p">:</span>
    <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu_db</span>
    <span class="nt">build</span><span class="p">:</span>
      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Dockerfile-mysql</span>
    <span class="nt">restart</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">always</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">"db-data:/var/lib/mysql"</span>
      <span class="c1"># mysql のカスタム設定ファイルもホスト &lt;-&gt; コンテナ間で同期しておく (編集するのに便利だから)</span>
      <span class="p p-Indicator">-</span> <span class="s">"./mysql/conf.d:/etc/mysql/conf.d"</span>
    <span class="nt">environment</span><span class="p">:</span>
      <span class="nt">MYSQL_ROOT_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu</span>
      <span class="nt">MYSQL_DATABASE</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu</span>
      <span class="nt">MYSQL_USER</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu</span>
      <span class="nt">MYSQL_PASSWORD</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu</span>

  <span class="nt">web</span><span class="p">:</span>
    <span class="nt">container_name</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">fu_web</span>
    <span class="nt">build</span><span class="p">:</span>
      <span class="nt">context</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">.</span>
      <span class="nt">dockerfile</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Dockerfile-web</span>
    <span class="nt">command</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">python3 manage.py runserver 0.0.0.0:8000 --settings=settings._</span>
    <span class="nt">volumes</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">.:/code</span>
    <span class="nt">ports</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="s">"6560:8000"</span>
    <span class="nt">depends_on</span><span class="p">:</span>
      <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">db</span>

<span class="nt">volumes</span><span class="p">:</span>
  <span class="nt">db-data</span><span class="p">:</span>
</pre></div>
</div>
</li>
<li>
<p class="first">fu/Dockerfile-web</p>
<p></p>
<div class="code-block ">
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> python:3</span>
<span class="k">ENV</span> PYTHONUNBUFFERED <span class="m">1</span>
<span class="k">RUN</span> mkdir /code
<span class="k">WORKDIR</span><span class="s"> /code</span>
<span class="k">ADD</span> requirements.txt /code/
<span class="k">RUN</span> pip install -r requirements.txt
<span class="k">ADD</span> . /code/
</pre></div>
</div>
</li>
<li>
<p class="first">fu/Dockerfile-mysql</p>
<p></p>
<div class="code-block ">
<div class="highlight"><pre><span></span><span class="k">FROM</span><span class="s"> mysql:latest</span>
<span class="c"># locales をインストールする</span>
<span class="k">RUN</span> apt-get clean <span class="o">&amp;&amp;</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y locales locales-all
<span class="c"># locale 定義ファイルをコンパイルする</span>
<span class="k">RUN</span> locale-gen ja_JP.UTF-8
<span class="c"># 日本語を設定する TODO: もしかして LANG だけでいいのかも...?</span>
<span class="k">ENV</span> LANG ja_JP.UTF-8
<span class="k">ENV</span> LANGUAGE ja_JP:en
<span class="k">ENV</span> LC_ALL ja_JP.UTF-8
<span class="c"># タイムゾーンに日本を設定する</span>
<span class="k">RUN</span> ln -sf /usr/share/zoneinfo/Japan /etc/localtime
</pre></div>
</div>
</li>
<li>
<p class="first">fu/requirements.txt</p>
<p></p>
<div class="code-block ">
<div class="highlight"><pre><span></span><span class="n">Django</span><span class="o">&gt;=</span><span class="mf">1.11</span>
<span class="n">mysqlclient</span><span class="o">&gt;=</span><span class="mf">1.3</span><span class="o">.</span><span class="mi">7</span>
<span class="n">mysql</span><span class="o">-</span><span class="n">connector</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
</li>
<li>
<p class="first">fu/mysql/conf.d/mysql.cnf</p>
<p></p>
<div class="code-block ">
<div class="highlight"><pre><span></span><span class="c1"># Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># This program is free software; you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License, version 2.0,</span>
<span class="c1"># as published by the Free Software Foundation.</span>
<span class="c1">#</span>
<span class="c1"># This program is also distributed with certain software (including</span>
<span class="c1"># but not limited to OpenSSL) that is licensed under separate terms,</span>
<span class="c1"># as designated in a particular file or component or in included license</span>
<span class="c1"># documentation.  The authors of MySQL hereby grant you an additional</span>
<span class="c1"># permission to link the program and your derivative works with the</span>
<span class="c1"># separately licensed software that they have included with MySQL.</span>
<span class="c1">#</span>
<span class="c1"># This program is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License, version 2.0, for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this program; if not, write to the Free Software</span>
<span class="c1"># Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301  USA</span>

<span class="c1">#</span>
<span class="c1"># The MySQL  Client configuration file.</span>
<span class="c1">#</span>
<span class="c1"># For explanations see</span>
<span class="c1"># http://dev.mysql.com/doc/mysql/en/server-system-variables.html</span>


<span class="na">[mysqld]  # mysqlサーバーの設定</span>
<span class="na">default-authentication-plugin</span><span class="o">=</span><span class="s">mysql_native_password</span>
<span class="c1"># Collation (文字照合順) の設定: https://mysqlserverteam.com/mysql-8-0-kana-sensitive-collation-for-japanese-ja_jp/</span>
<span class="na">collation-server</span><span class="o">=</span><span class="s">utf8mb4_ja_0900_as_cs_ks</span>
<span class="c1"># サーバー側の文字コードの設定: "Default Value (&gt;= 8.0.1)	utf8mb4" だけれどもなんとなく念のため指定</span>
<span class="na">character-set-server</span><span class="o">=</span><span class="s">utf8mb4</span>
<span class="c1"># time_zone の設定: https://dev.mysql.com/doc/refman/8.0/en/server-options.html#option_mysqld_default-time-zone</span>
<span class="na">default-time-zone</span><span class="o">=</span><span class="s">'Asia/Tokyo'</span>

<span class="na">[client]  # mysqlクライアントの設定</span>
<span class="c1"># クライアント側の文字コードの設定</span>
<span class="c1"># utf8mb4: A UTF-8 encoding of the Unicode character set using one to four bytes per character.</span>
<span class="na">default-character-set</span><span class="o">=</span><span class="s">utf8mb4</span>
</pre></div>
</div>
<ul>
<li>
<p class="first">MySQL デフォルトの設定ファイルは <tt class="docutils literal">/etc/mysql/my.cnf</tt> の模様。 MySQL 公式イメージからコンテナを作成すると、初期状態で <tt class="docutils literal">/etc/mysql/my.cnf</tt> 中に</p>
<pre class="code cfg"><a name="rest_code_3903d54a8a094655b34207a4d16c3a99-1"></a><span class="c1"># Custom config should go here</span>
<a name="rest_code_3903d54a8a094655b34207a4d16c3a99-2"></a><span class="na">!includedir /etc/mysql/conf.d/</span>
</pre>
<p>と書いてあるので、言に従い自分用設定は <tt class="docutils literal">/etc/mysql/conf.d/</tt> に記述した。</p>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="id8">
<h2><a class="toc-backref" href="#id18">使い方メモ</a></h2>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#id19">イメージビルドからやり直したい</a></h3>
<p>こんなときは...</p>
<ul class="simple">
<li>requirements.txt にライブラリを書き足したとき</li>
<li>Dockerfile を更新したとき</li>
</ul>
<pre class="code bash"><a name="rest_code_f0ce9ee05d834cbeaa12684b655f87be-1"></a>$ docker-compose build
<a name="rest_code_f0ce9ee05d834cbeaa12684b655f87be-2"></a>$ docker-compose up
</pre>
<p>もしくは、</p>
<pre class="code bash"><a name="rest_code_32a40d524d4c45d29f70522d57337080-1"></a>$ docker-compose up --build
</pre>
</div>
<div class="section" id="volume">
<h3><a class="toc-backref" href="#id20">volume は消さない限り再利用される</a></h3>
<pre class="code yaml"><a name="rest_code_5efa7c7a699f44c4986826cd65437585-1"></a><span class="c1"># fu/docker-compose.yml</span>
<a name="rest_code_5efa7c7a699f44c4986826cd65437585-2"></a>
<a name="rest_code_5efa7c7a699f44c4986826cd65437585-3"></a><span class="nt">volumes</span><span class="p">:</span>
<a name="rest_code_5efa7c7a699f44c4986826cd65437585-4"></a>  <span class="nt">db-data</span><span class="p">:</span>
</pre>
<pre class="code bash"><a name="rest_code_c862d17ac1af4210a1c48e60ad993a55-1"></a>$ docker volume ls
<a name="rest_code_c862d17ac1af4210a1c48e60ad993a55-2"></a>DRIVER              VOLUME NAME
<a name="rest_code_c862d17ac1af4210a1c48e60ad993a55-3"></a><span class="nb">local</span>               fu_db-data  <span class="c1"># こういう名前がついている</span>
</pre>
</div>
<div class="section" id="web">
<h3><a class="toc-backref" href="#id21">web のほうのコンテナだけ再起動したいとき</a></h3>
<pre class="code bash"><a name="rest_code_211b15d20eab4d30ac016b6d3a30b019-1"></a>$ docker container restart fu_web
</pre>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id22">web のほうのコンテナに入る</a></h3>
<p>VM の中に入るのと同じような気持ち。</p>
<pre class="code bash"><a name="rest_code_654bd601da404946b847dae6a92f6346-1"></a>$ docker container <span class="nb">exec</span> -it fu_web bash
<a name="rest_code_654bd601da404946b847dae6a92f6346-2"></a>root@eb1ab9a6dbdb:/code#
<a name="rest_code_654bd601da404946b847dae6a92f6346-3"></a>
<a name="rest_code_654bd601da404946b847dae6a92f6346-4"></a><span class="c1"># 現在のロケール設定を確認する</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-5"></a>root@eb1ab9a6dbdb:/code# locale
<a name="rest_code_654bd601da404946b847dae6a92f6346-6"></a><span class="nv">LANG</span><span class="o">=</span>C.UTF-8
<a name="rest_code_654bd601da404946b847dae6a92f6346-7"></a><span class="nv">LANGUAGE</span><span class="o">=</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-8"></a><span class="nv">LC_CTYPE</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-9"></a><span class="nv">LC_NUMERIC</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-10"></a><span class="nv">LC_TIME</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-11"></a><span class="nv">LC_COLLATE</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-12"></a><span class="nv">LC_MONETARY</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-13"></a><span class="nv">LC_MESSAGES</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-14"></a><span class="nv">LC_PAPER</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-15"></a><span class="nv">LC_NAME</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-16"></a><span class="nv">LC_ADDRESS</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-17"></a><span class="nv">LC_TELEPHONE</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-18"></a><span class="nv">LC_MEASUREMENT</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-19"></a><span class="nv">LC_IDENTIFICATION</span><span class="o">=</span><span class="s2">"C.UTF-8"</span>
<a name="rest_code_654bd601da404946b847dae6a92f6346-20"></a><span class="nv">LC_ALL</span><span class="o">=</span>
</pre>
</div>
<div class="section" id="mysql">
<h3><a class="toc-backref" href="#id23">mysql のほうのコンテナに入る</a></h3>
<pre class="code bash"><a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-1"></a><span class="c1"># mysql のコンテナに入る</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-2"></a>$ docker container <span class="nb">exec</span> -it fu_db bash
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-3"></a>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-4"></a><span class="c1"># 現在のロケール設定を確認する</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-5"></a>root@dcc8b4d2cd21:/# locale
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-6"></a><span class="nv">LANG</span><span class="o">=</span>ja_JP.UTF-8
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-7"></a><span class="nv">LANGUAGE</span><span class="o">=</span>ja_JP:en
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-8"></a><span class="nv">LC_CTYPE</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-9"></a><span class="nv">LC_NUMERIC</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-10"></a><span class="nv">LC_TIME</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-11"></a><span class="nv">LC_COLLATE</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-12"></a><span class="nv">LC_MONETARY</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-13"></a><span class="nv">LC_MESSAGES</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-14"></a><span class="nv">LC_PAPER</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-15"></a><span class="nv">LC_NAME</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-16"></a><span class="nv">LC_ADDRESS</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-17"></a><span class="nv">LC_TELEPHONE</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-18"></a><span class="nv">LC_MEASUREMENT</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-19"></a><span class="nv">LC_IDENTIFICATION</span><span class="o">=</span><span class="s2">"ja_JP.UTF-8"</span>
<a name="rest_code_4d8ae125fe674f86ae87c32d3e032395-20"></a><span class="nv">LC_ALL</span><span class="o">=</span>ja_JP.UTF-8
</pre>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#id24">mysql に入る</a></h3>
<pre class="code bash"><a name="rest_code_c3c81149a671409fabd888c67d128ddb-1"></a><span class="c1"># mysql のコンテナに入る</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-2"></a>$ docker container <span class="nb">exec</span> -it fu_db bash
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-3"></a>root@6ba1661872de:/#
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-4"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-5"></a><span class="c1"># mysql にログインする</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-6"></a>$ mysql -h localhost -u fu -p fu
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-7"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-8"></a>Enter password: <span class="o">(</span>compose ファイルに定義したパスワード<span class="o">)</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-9"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-10"></a><span class="c1"># 現在の Character Sets 設定を表示する</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-11"></a>mysql&gt; SHOW VARIABLES LIKE <span class="s2">"char%"</span><span class="p">;</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-12"></a>+--------------------------+--------------------------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-13"></a><span class="p">|</span> Variable_name            <span class="p">|</span> Value                          <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-14"></a>+--------------------------+--------------------------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-15"></a><span class="p">|</span> character_set_client     <span class="p">|</span> utf8mb4                        <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-16"></a><span class="p">|</span> character_set_connection <span class="p">|</span> utf8mb4                        <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-17"></a><span class="p">|</span> character_set_database   <span class="p">|</span> utf8mb4                        <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-18"></a><span class="p">|</span> character_set_filesystem <span class="p">|</span> binary                         <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-19"></a><span class="p">|</span> character_set_results    <span class="p">|</span> utf8mb4                        <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-20"></a><span class="p">|</span> character_set_server     <span class="p">|</span> utf8mb4                        <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-21"></a><span class="p">|</span> character_set_system     <span class="p">|</span> utf8                           <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-22"></a><span class="p">|</span> character_sets_dir       <span class="p">|</span> /usr/share/mysql-8.0/charsets/ <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-23"></a>+--------------------------+--------------------------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-24"></a><span class="m">8</span> rows in <span class="nb">set</span> <span class="o">(</span><span class="m">0</span>.01 sec<span class="o">)</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-25"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-26"></a><span class="c1"># 現在のタイムゾーン設定を表示する</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-27"></a>mysql&gt; SHOW VARIABLES LIKE <span class="s1">'%time_zone%'</span><span class="p">;</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-28"></a>+------------------+------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-29"></a><span class="p">|</span> Variable_name    <span class="p">|</span> Value      <span class="p">|</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-30"></a>+------------------+------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-31"></a><span class="p">|</span> system_time_zone <span class="p">|</span> JST        <span class="p">|</span>  <span class="c1"># MySQL が動いているコンテナ (Debian) のシステムタイムゾーン、Dockerfile-mysql で設定した</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-32"></a><span class="p">|</span> time_zone        <span class="p">|</span> Asia/Tokyo <span class="p">|</span>  <span class="c1"># mysql.cnf で設定した MySQL サーバー側のタイムゾーン</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-33"></a>+------------------+------------+
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-34"></a><span class="m">2</span> rows in <span class="nb">set</span> <span class="o">(</span><span class="m">0</span>.01 sec<span class="o">)</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-35"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-36"></a>mysql&gt; status
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-37"></a>--------------
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-38"></a>mysql  Ver <span class="m">8</span>.0.13 <span class="k">for</span> Linux on x86_64 <span class="o">(</span>MySQL Community Server - GPL<span class="o">)</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-39"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-40"></a>Connection id:                <span class="m">11</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-41"></a>Current database:     fu
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-42"></a>Current user:         fu@localhost
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-43"></a>SSL:                  Not in use
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-44"></a>Current pager:                stdout
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-45"></a>Using outfile:                <span class="s1">''</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-46"></a>Using delimiter:      <span class="p">;</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-47"></a>Server version:               <span class="m">8</span>.0.13 MySQL Community Server - GPL
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-48"></a>Protocol version:     <span class="m">10</span>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-49"></a>Connection:           Localhost via UNIX socket
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-50"></a>Server characterset:  utf8mb4
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-51"></a>Db     characterset:  utf8mb4
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-52"></a>Client characterset:  utf8mb4
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-53"></a>Conn.  characterset:  utf8mb4
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-54"></a>UNIX socket:          /var/run/mysqld/mysqld.sock
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-55"></a>Uptime:                       <span class="m">2</span> hours <span class="m">9</span> min <span class="m">49</span> sec
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-56"></a>
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-57"></a>Threads: <span class="m">3</span>  Questions: <span class="m">40</span>  Slow queries: <span class="m">0</span>  Opens: <span class="m">189</span>  Flush tables: <span class="m">2</span>  Open tables: <span class="m">163</span>  Queries per second avg: <span class="m">0</span>.005
<a name="rest_code_c3c81149a671409fabd888c67d128ddb-58"></a>--------------
</pre>
</div>
</div>
<div class="section" id="todo">
<h2><a class="toc-backref" href="#id25">TODO</a></h2>
<p>web コンテナのほうの locale と タイムゾーンは db コンテナと合わせなくて大丈夫なんだろうか...</p>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>
</html>
