<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Django REST framework のメモ/ふみのて</title>
<link rel="shortcut icon" href="../assets/icons/favicon.ico">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link rel="stylesheet" href="../assets/css/style.css?20190615">
</head>
<body>
    <div class="container">
      <div class="header"><header class="item item-header"><h1>
    <a href="../">
      <img class="logo" src="../assets/images/inuu.png" alt="犬"></a>
  </h1>
  <iframe src="../tags/" class="tags"></iframe>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-django-rest-framework"><time class="date" datetime="2019-07-16 00:00:00+09:00">
      2019-07-16 Tue
    </time><div class="title">Django REST framework のメモ</div>
    <div class="category">
      <a href="../tags/django-rest-framework/">
          django-rest-framework
      </a>
    </div>
    <div class="text">
      <div>
<details><summary>目次</summary><div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id6">ガイド/リファレンス</a></li>
<li>
<a class="reference internal" href="#id3" id="id7">メモ</a><ul>
<li><a class="reference internal" href="#id4" id="id8">コマンドでアクセスする場合</a></li>
<li><a class="reference internal" href="#apiview" id="id9">クラスベース (APIView) で記述するのがおすすめ</a></li>
<li><a class="reference internal" href="#router" id="id10">Router</a></li>
<li><a class="reference internal" href="#browsable-api" id="id11">Browsable API</a></li>
<li><a class="reference internal" href="#browsable-api-html-form" id="id12">Browsable API で HTML form タブが出せる</a></li>
<li><a class="reference internal" href="#id5" id="id13">django-cors-headers</a></li>
<li><a class="reference internal" href="#drf-request" id="id14">DRF の Request</a></li>
<li><a class="reference internal" href="#drf-response" id="id15">DRF の Response</a></li>
<li><a class="reference internal" href="#api" id="id16">API ビュー</a></li>
</ul>
</li>
</ul>
</div>
</details><div class="section" id="id2">
<h2><a class="toc-backref" href="#id6">ガイド/リファレンス</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://www.django-rest-framework.org/">Django REST framework</a></li>
<li><a class="reference external" href="http://note.crohaco.net/2018/django-rest-framework-view/">くろのて &gt; [Django REST Framework] View の使い方をまとめてみた</a></li>
<li><a class="reference external" href="http://note.crohaco.net/2018/django-rest-framework-serializer/">くろのて &gt; [Django REST Framework] Serializer の 使い方 をまとめてみた</a></li>
<li><a class="reference external" href="http://note.crohaco.net/2019/http-cors-preflight/">くろのて &gt; CORS とか Preflight とかよくわかんないよな</a></li>
<li><a class="reference external" href="https://qiita.com/kimihiro_n/items/86e0a9e619720e57ecd8">Django REST Frameworkを使って爆速でAPIを実装する</a></li>
<li><a class="reference external" href="https://github.com/ottoyiu/django-cors-headers">django-cors-headers</a></li>
</ul>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id7">メモ</a></h2>
<div class="section" id="id4">
<h3><a class="toc-backref" href="#id8">コマンドでアクセスする場合</a></h3>
<pre class="code bash"><a name="rest_code_2581cfaaad18421cb592aaa4612855fb-1"></a><span class="c1"># curl の場合</span>
<a name="rest_code_2581cfaaad18421cb592aaa4612855fb-2"></a>$ curl -H <span class="s1">'Accept: application/json; indent=4'</span> -u &lt;username&gt;:&lt;password&gt; http://127.0.0.1:8989/users/
<a name="rest_code_2581cfaaad18421cb592aaa4612855fb-3"></a>
<a name="rest_code_2581cfaaad18421cb592aaa4612855fb-4"></a><span class="c1"># HTTPie の場合</span>
<a name="rest_code_2581cfaaad18421cb592aaa4612855fb-5"></a><span class="c1"># https://httpie.org/doc</span>
<a name="rest_code_2581cfaaad18421cb592aaa4612855fb-6"></a>$ http -a &lt;username&gt;:&lt;password&gt; http://127.0.0.1:8989/users/
</pre>
</div>
<div class="section" id="apiview">
<h3><a class="toc-backref" href="#id9">クラスベース (APIView) で記述するのがおすすめ</a></h3>
<ul class="simple">
<li>特定のモデルに紐付かないような処理は クラスベースで記述するのがおすすめと言えるでしょう。 (くろのて)<ul>
<li>クエリが複雑すぎて queryset じゃ処理しきれないとかで SQLAlchemy で処理した結果を返したい という場合などに APIView を使っています。 (くろのて)</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="router">
<h3><a class="toc-backref" href="#id10">Router</a></h3>
<ul class="simple">
<li>Router で登録できるのは ViewSet だけ</li>
<li>DefaultRouter: Router のルート画面にアクセスしたときに API のリンク一覧を見せてくれる</li>
</ul>
</div>
<div class="section" id="browsable-api">
<h3><a class="toc-backref" href="#id11">Browsable API</a></h3>
<ul class="simple">
<li>rest_framework.response.Response を返すと Browsable API で見られるようだ!</li>
</ul>
</div>
<div class="section" id="browsable-api-html-form">
<h3><a class="toc-backref" href="#id12">Browsable API で HTML form タブが出せる</a></h3>
<table border="1" class="colwidths-auto docutils"><tbody valign="top">
<tr>
<th class="stub">viewsets.ModelViewSet</th>
<td>継承するだけで出る</td>
</tr>
<tr>
<th class="stub">APIView</th>
<td>
<tt class="docutils literal">serializer_class = SnippetSerializer</tt> を指定すると出る</td>
</tr>
<tr>
<th class="stub">Generic view</th>
<td>
<p class="first"><tt class="docutils literal">serializer_class = SnippetSerializer</tt> を指定すると出る</p>
<ul class="last simple">
<li>というか、指定しないとどの serializer と対応してるかわからないからどのみち指定することになる</li>
</ul>
</td>
</tr>
</tbody></table>
<ul class="simple">
<li>see: <a class="reference external" href="https://stackoverflow.com/questions/14616489/django-rest-framework-autogenerate-form-in-browsable-api">https://stackoverflow.com/questions/14616489/django-rest-framework-autogenerate-form-in-browsable-api</a>
</li>
</ul>
</div>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#id13">django-cors-headers</a></h3>
<ul class="simple">
<li>allow の origin からのアクセスだったら、 <tt class="docutils literal"><span class="pre">Access-Control-Allow-Origin</span></tt>  ヘッダーには origin が設定されて返る</li>
<li>allow じゃない origin からのアクセスだったら <tt class="docutils literal"><span class="pre">Access-Control-Allow-Origin</span></tt> ヘッダー自体が返らない</li>
<li>そういう実装になっている</li>
<li>理由は、「これは OK だよ」と教えちゃうと、悪いひとが偽装したりするから (きっと)</li>
</ul>
</div>
<div class="section" id="drf-request">
<h3><a class="toc-backref" href="#id14">DRF の Request</a></h3>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name">
<col class="field-body">
<tbody valign="top">
<tr class="field">
<th class="field-name">request.POST:</th>
<td class="field-body">
<p class="first">Only handles form data. Only works for 'POST' method.</p>
</td>
</tr>
<tr class="field">
<th class="field-name">request.data:</th>
<td class="field-body">
<p class="first">Handles arbitrary data. Works for 'POST', 'PUT' and 'PATCH' methods.</p>
<ul class="last simple">
<li>json request をはじめとして他の形式も処理できる</li>
</ul>
</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="drf-response">
<h3><a class="toc-backref" href="#id15">DRF の Response</a></h3>
<table border="1" class="colwidths-auto docutils"><tbody valign="top"><tr>
<th class="stub">return Response(data)</th>
<td>
<p class="first">Renders to content type as requested by the client.</p>
<ul class="last simple">
<li>RESTフレームワークがレスポンスを正しいコンテンツタイプに変換してくれる</li>
<li>レスポンスが単一のコンテンツタイプに固定されていない</li>
</ul>
</td>
</tr></tbody></table>
</div>
<div class="section" id="api">
<h3><a class="toc-backref" href="#id16">API ビュー</a></h3>
<p>RESTフレームワークには、APIビューを書くために使用できる2つのラッパーがあります。</p>
<ol class="arabic simple">
<li>@api_view 関数ベースのビューを扱うためのデコレータ。</li>
<li>APIView クラスベースのビューを操作するためのクラス。</li>
</ol>
</div>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>
</html>
