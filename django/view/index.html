<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Django: View/ふみのて</title>
<link rel="shortcut icon" href="../../assets/icons/favicon.ico">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link rel="stylesheet" href="../../assets/css/style.css?20190613">
</head>
<body>
    <div class="container">
      <div class="header"><header class="item item-header"><h1>
    <a href="../../">
      <img class="logo" src="../../assets/images/inuu.png" alt="犬"></a>
  </h1>
  <nav class="nav"><ul>
<li class="nav-category"><a href="../../">HOME</a></li>
    </ul></nav><iframe src="../../tags/" class="tags-frame"></iframe>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-django"><time class="date" datetime="2019-05-05 00:00:00+09:00">
      2019-05-05 Sun
    </time><div class="title">Django: View</div>
    <div class="category">
      <a href="../../tags/django/">
          django
      </a>
    </div>
    <div class="text">
      <div>
<details><summary>目次</summary><div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id7">リファレンス/書籍</a></li>
<li><a class="reference internal" href="#id4" id="id8">関数ベースのビュー</a></li>
<li>
<a class="reference internal" href="#class-based-views" id="id9">クラスベースのビュー (Class-based views)</a><ul>
<li><a class="reference internal" href="#as-view" id="id10">as_view</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#base-views" id="id11">Base views</a><ul>
<li><a class="reference internal" href="#view" id="id12">View</a></li>
<li>
<a class="reference internal" href="#templateview" id="id13">TemplateView</a><ul>
<li><a class="reference internal" href="#get-context-data" id="id14">get_context_data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#redirectview" id="id15">RedirectView</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#generic-views" id="id16">いろいろな Generic views</a><ul>
<li><a class="reference internal" href="#listview" id="id17">ListView</a></li>
<li><a class="reference internal" href="#formview" id="id18">FormView</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#id5" id="id19">ログイン・ログアウト</a><ul>
<li><a class="reference internal" href="#loginview-logoutview" id="id20">LoginView, LogoutView</a></li>
<li><a class="reference internal" href="#loginrequiredmixin" id="id21">LoginRequiredMixin</a></li>
</ul>
</li>
</ul>
</div>
</details><div class="section" id="id2">
<h2><a class="toc-backref" href="#id7">リファレンス/書籍</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.djangoproject.com/ja/2.2/topics/class-based-views/">Django documentation &gt; クラスベースビュー</a></li>
<li><a class="reference external" href="https://docs.djangoproject.com/ja/2.2/ref/class-based-views/">Django documentation &gt; ビルトインのクラスベースビュー API</a></li>
<li><a class="reference external" href="https://www.amazon.co.jp/dp/B07GK7BWB7/">現場で使える Django の教科書</a></li>
<li><a class="reference external" href="http://note.crohaco.net/2015/django-genericview/">くろのて &gt; [Django]ジェネリックビューってなんなんだよ</a></li>
<li>crohaco さん、 shimizukawa さん、 tell-k さん</li>
</ul>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id8">関数ベースのビュー</a></h2>
<ul class="simple">
<li>第一引数に django.http.request.HttpRequest を受け取る</li>
<li>戻り値に django.http.response.HttpResponse を返す</li>
</ul>
<pre class="code python"><a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-1"></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-2"></a>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-3"></a>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-4"></a><span class="k">def</span> <span class="nf">HelloView</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-5"></a>    <span class="sd">"""関数ベースのビュー"""</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-6"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">'GET'</span><span class="p">:</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-7"></a>        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-8"></a>            <span class="s1">'message'</span><span class="p">:</span> <span class="s2">"Hello World!"</span><span class="p">,</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-9"></a>        <span class="p">}</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-10"></a>        <span class="c1"># render:</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-11"></a>        <span class="c1">#   * HttpResponse を作ってくれる</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-12"></a>        <span class="c1">#   * テンプレートをレンダリングするとき使う</span>
<a name="rest_code_600fe1d4ebf54a94b11587c3e4f07122-13"></a>        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'hello.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="class-based-views">
<h2><a class="toc-backref" href="#id9">クラスベースのビュー (Class-based views)</a></h2>
<ul class="simple">
<li>関数形式の view はコンテキスト、テンプレート、フォーム、全部変えしてあげないといけなかった。つまり全部関数内に書く必要があった。
必要なものを切り離して属性として定義できるようにしたのが genericview (class based view)。</li>
<li>akiyoko さんは断然、クラスベースビューをお勧めするとのこと<ul>
<li>汎用ビュー (Generic View) としてさまざまな用途のクラスが提供されているのでその恩恵を受けられる</li>
<li>すべての基本となる基本汎用ビュー <tt class="docutils literal">django.views.generic.base.View</tt> を利用すれば見通しのよいビューが書けるし、応用も効く</li>
<li>汎用ビューのほかにも便利な Mixin クラスを多重継承してお決まりの処理を再利用できる</li>
</ul>
</li>
</ul>
<pre class="code python"><a name="rest_code_0228b6f0dd204e07948b12bced91becf-1"></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-2"></a><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-3"></a><span class="c1"># from django.views.generic import View と同義↑</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-4"></a>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-5"></a>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-6"></a><span class="k">class</span> <span class="nc">HelloView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-7"></a>    <span class="sd">"""クラスベースのビュー"""</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-8"></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-9"></a>        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-10"></a>            <span class="s1">'message'</span><span class="p">:</span> <span class="s2">"Hello World!"</span><span class="p">,</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-11"></a>        <span class="p">}</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-12"></a>        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'hello.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-13"></a>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-14"></a>
<a name="rest_code_0228b6f0dd204e07948b12bced91becf-15"></a><span class="n">hello</span> <span class="o">=</span> <span class="n">HelloView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre>
<pre class="code python"><a name="rest_code_d839e3083e144a81922da090ba504ab1-1"></a><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="kn">import</span> <span class="n">login</span> <span class="k">as</span> <span class="n">auth_login</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-2"></a><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="kn">import</span> <span class="n">render</span><span class="p">,</span> <span class="n">redirect</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-3"></a><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-4"></a><span class="kn">from</span> <span class="nn">django.views</span> <span class="kn">import</span> <span class="n">View</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-5"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-6"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-7"></a><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-8"></a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-9"></a>        <span class="sd">"""GET リクエスト"""</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-10"></a>        <span class="n">context</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-11"></a>            <span class="s1">'form'</span><span class="p">:</span> <span class="n">LoginForm</span><span class="p">(),</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-12"></a>        <span class="p">}</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-13"></a>        <span class="c1"># ログイン画面用のテンプレートに値が空のフォームをレンダリング</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-14"></a>        <span class="c1"># render: テンプレートをレンダリングするとき使う</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-15"></a>        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'accounts/login.html'</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-16"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-17"></a>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-18"></a>        <span class="sd">"""POST リクエスト"""</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-19"></a>        <span class="c1"># リクエストからフォームを作成</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-20"></a>        <span class="n">form</span> <span class="o">=</span> <span class="n">LoginForm</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-21"></a>        <span class="c1"># バリデーション (ユーザーの認証も併せて実施)</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-22"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-23"></a>            <span class="c1"># バリデーション NG の場合はログイン画面のテンプレートを再表示</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-24"></a>            <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">'accounts/login.html'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'form'</span><span class="p">:</span> <span class="n">form</span><span class="p">})</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-25"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-26"></a>        <span class="c1"># User オブジェクトをフォームから取得</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-27"></a>        <span class="n">user</span> <span class="o">=</span> <span class="n">form</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-28"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-29"></a>        <span class="c1"># ログイン処理 (取得した User オブジェクトをセッションに保存 &amp; User データを更新)</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-30"></a>        <span class="n">auth_login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-31"></a>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-32"></a>        <span class="c1"># ショップ画面にリダイレクト</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-33"></a>        <span class="c1"># redirect: リダイレクトするとき使う</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-34"></a>        <span class="c1">#   * リダイレクト先のURLは reverse を使って取得する</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-35"></a>        <span class="c1">#   * ハードコーディングするなかれ</span>
<a name="rest_code_d839e3083e144a81922da090ba504ab1-36"></a>        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">reverse</span><span class="p">(</span><span class="s1">'shop:index'</span><span class="p">))</span>
</pre>
<div class="section" id="as-view">
<h3><a class="toc-backref" href="#id10">as_view</a></h3>
<ul class="simple">
<li><a class="reference external" href="https://github.com/django/django/blob/master/django/views/generic/base.py#L49">https://github.com/django/django/blob/master/django/views/generic/base.py#L49</a></li>
<li>クラスベースのビューをビュー関数化してくれるメソッド<ul>
<li>as_view は view 関数を生成して返している</li>
<li>これをしておくと、URL ディスパッチャだけでなく他のビューからも呼び出せるようになる</li>
<li>実際の処理は self.dispatch で クラスベースビューに処理を委譲してるんだと思います</li>
</ul>
</li>
<li>urls.py で as_view せずに、 views.py で as_view した Class-based view をグローバル変数に代入するとうれしいタイミング<ul>
<li>同じ view を複数の url に設定したい<ul>
<li>モジュールの import が1回しか発生しないのはモジュール毎の話じゃなくプロセス全体 ( Django で言うと <tt class="docutils literal"><span class="pre">runserver...</span></tt> した単位) の話</li>
<li>url ごとに同じ View を何回も生成するんだったら、同じでよい (シングルトン)</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="base-views">
<h2><a class="toc-backref" href="#id11">Base views</a></h2>
<div class="section" id="view">
<h3><a class="toc-backref" href="#id12">View</a></h3>
<ul class="simple">
<li>django.views.generic.base.View</li>
<li>すべての元となるクラスベースビューです。他の全てのクラスベースビューは、この基本クラスを継承しています。</li>
</ul>
</div>
<div class="section" id="templateview">
<h3><a class="toc-backref" href="#id13">TemplateView</a></h3>
<ul class="simple">
<li>テンプレートを表示することに特化した Generic View</li>
<li>トップ画面やヘルプ画面などの単純なテンプレートを表示するのによく使う</li>
<li>オーバーライドできる変数やメソッドがいくつか用意されていて、デフォルトの挙動をある程度自由に変更できる</li>
</ul>
<pre class="code python"><a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-1"></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">TemplateView</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-2"></a><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-3"></a>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-4"></a>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-5"></a><span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">TemplateView</span><span class="p">):</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-6"></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'index.html'</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-7"></a>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-8"></a>    <span class="k">def</span> <span class="nf">get_context_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-9"></a>        <span class="c1"># get_context_data をオーバーライドした例</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-10"></a>        <span class="c1"># テンプレートに渡すコンテキストに任意の変数を追加できる</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-11"></a>        <span class="n">context</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">IndexView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">get_context_data</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-12"></a>        <span class="c1"># テンプレートに渡すコンテキストに `user_count` という変数を追加</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-13"></a>        <span class="n">context</span><span class="p">[</span><span class="s1">'user_count'</span><span class="p">]</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-14"></a>        <span class="k">return</span> <span class="n">context</span>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-15"></a>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-16"></a>
<a name="rest_code_33fb056e049e44ad91c2153e61bfff6d-17"></a><span class="n">index</span> <span class="o">=</span> <span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre>
<div class="section" id="get-context-data">
<h4><a class="toc-backref" href="#id14">get_context_data</a></h4>
<ul class="simple">
<li>大抵の場合、ビューというのはレンダリングに必要なコンテキストを組み立てるものなので 大体の処理は <tt class="docutils literal">get_context_data</tt> というメソッドに書く。</li>
</ul>
</div>
</div>
<div class="section" id="redirectview">
<h3><a class="toc-backref" href="#id15">RedirectView</a></h3>
<ul class="simple">
<li>リダイレクトに特化した Generic View</li>
<li>任意の URL にリダイレクトすることに特化したやつ</li>
</ul>
<pre class="code python"><a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-1"></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">RedirectView</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-2"></a>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-3"></a>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-4"></a><span class="k">class</span> <span class="nc">IndexView</span><span class="p">(</span><span class="n">RedirectView</span><span class="p">):</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-5"></a>    <span class="n">url</span> <span class="o">=</span> <span class="s1">'/accounts/login/'</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-6"></a>    <span class="c1"># pattern_name = 'accounts:login'  # パターンで URL を指定する場合</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-7"></a>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-8"></a>    <span class="k">def</span> <span class="nf">get_redirect_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-9"></a>        <span class="c1"># リダイレクトする URL を動的に組み立てるためのやつをオーバーライドできる</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-10"></a>        <span class="k">pass</span>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-11"></a>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-12"></a>
<a name="rest_code_e0fa5bf2354248dea0e6afcc709b1228-13"></a><span class="n">index</span> <span class="o">=</span> <span class="n">IndexView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()</span>
</pre>
</div>
</div>
<div class="section" id="generic-views">
<h2><a class="toc-backref" href="#id16">いろいろな Generic views</a></h2>
<ul class="simple">
<li>これが便利とのこと: <a class="reference external" href="https://ccbv.co.uk/">https://ccbv.co.uk/</a>
</li>
</ul>
<div class="section" id="listview">
<h3><a class="toc-backref" href="#id17">ListView</a></h3>
<ul class="simple">
<li>モデルオブジェクトの一覧を表示するための View</li>
</ul>
<pre class="code python"><a name="rest_code_cfb839f4b074427280e8f7847ead49ee-1"></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-2"></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-3"></a>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-4"></a>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-5"></a><span class="k">class</span> <span class="nc">BookListView1</span><span class="p">(</span><span class="n">ListView</span><span class="p">):</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-6"></a>    <span class="c1"># リストしたいモデルを指定する</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-7"></a>    <span class="c1"># これだけで、 `shop/book_list.html` という名前のテンプレートに、</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-8"></a>    <span class="c1"># object_list (or book_list) という変数名で、</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-9"></a>    <span class="c1"># Book モデルの全てのレコードの一覧を渡してくれる</span>
<a name="rest_code_cfb839f4b074427280e8f7847ead49ee-10"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
</pre>
<pre class="code python"><a name="rest_code_e9f011f5a17443479d7ec8595611b733-1"></a><span class="c1"># ほかにもいろいろある...</span>
<a name="rest_code_e9f011f5a17443479d7ec8595611b733-2"></a><span class="c1"># 利用するテンプレートを指定する</span>
<a name="rest_code_e9f011f5a17443479d7ec8595611b733-3"></a><span class="n">template_name</span> <span class="o">=</span> <span class="s1">'husky.html'</span>
<a name="rest_code_e9f011f5a17443479d7ec8595611b733-4"></a><span class="c1"># オブジェクトの一覧を取得するためのクエリセットを指定する</span>
<a name="rest_code_e9f011f5a17443479d7ec8595611b733-5"></a><span class="n">queryset</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">price__gt</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre>
</div>
<div class="section" id="formview">
<h3><a class="toc-backref" href="#id18">FormView</a></h3>
<ul class="simple">
<li>何らかの登録・更新処理で <tt class="docutils literal">form</tt> を使ったバリデーションが必要なら 大体 <tt class="docutils literal">FormView</tt> を使う</li>
</ul>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id19">ログイン・ログアウト</a></h2>
<ul class="simple">
<li>
<a class="reference external" href="https://www.amazon.co.jp/dp/B07GK7BWB7/">現場で使える Django の教科書</a> P.43 によく書いてあるのでそちらを参照のこと<ul>
<li>request.user:<ul>
<li>ログイン済: User オブジェクト</li>
<li>未ログイン: AnonymousUser オブジェクト</li>
</ul>
</li>
<li>ログイン済みか否か: request.user.is_authenticated</li>
<li>ログアウトすると、<ul>
<li>サーバーのセッションクリア</li>
<li>request.user に AnonymousUser をセット</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="section" id="loginview-logoutview">
<h3><a class="toc-backref" href="#id20">LoginView, LogoutView</a></h3>
<ul class="simple">
<li>ログインに特化した View: django.contrib.auth.views.LoginView</li>
<li>ログアウトに特化した View: django.contrib.auth.views.LogoutView</li>
</ul>
<pre class="code python"><a name="rest_code_29a648936a244878a69c43ec761fdc69-1"></a><span class="kn">from</span> <span class="nn">django.contrib.auth.views</span> <span class="kn">import</span> <span class="n">LoginView</span> <span class="k">as</span> <span class="n">AuthLoginView</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-2"></a>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-3"></a>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-4"></a><span class="k">class</span> <span class="nc">LoginView</span><span class="p">(</span><span class="n">AuthLoginView</span><span class="p">):</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-5"></a>    <span class="sd">"""</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-6"></a><span class="sd">    ログインビューの実装例</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-7"></a>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-8"></a><span class="sd">    * 設定値の調整が必要になることもあるよ</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-9"></a>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-10"></a><span class="sd">      * LOGIN_URL</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-11"></a><span class="sd">      * LOGIN_REDIRECT_URL</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-12"></a><span class="sd">      * LOGOUT_REDIRECT_URL</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-13"></a><span class="sd">    """</span>
<a name="rest_code_29a648936a244878a69c43ec761fdc69-14"></a>    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">'accounts/login.html'</span>
</pre>
</div>
<div class="section" id="loginrequiredmixin">
<h3><a class="toc-backref" href="#id21">LoginRequiredMixin</a></h3>
<ul class="simple">
<li>LoginRequiredMixin: 未ログインのユーザーがアクセスしようとしたときに何らかのペナルティを課すための Mixin<ul>
<li>Django1.9 から導入された</li>
<li>継承すると、未ログインユーザーがアクセスしたらば LOGIN_URL で定義した URL にリダイレクトしてくれるよ</li>
</ul>
</li>
</ul>
<pre class="code python"><a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-1"></a><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="kn">import</span> <span class="n">LoginRequiredMixin</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-2"></a><span class="kn">from</span> <span class="nn">django.views.generic</span> <span class="kn">import</span> <span class="n">ListView</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-3"></a>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-4"></a><span class="kn">from</span> <span class="nn">.models</span> <span class="kn">import</span> <span class="n">Book</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-5"></a>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-6"></a>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-7"></a><span class="k">class</span> <span class="nc">BookListView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">ListView</span><span class="p">):</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-8"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">Book</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-9"></a>    <span class="c1"># 403 エラー画面を表示する場合は次のコメントアウトを外す</span>
<a name="rest_code_070c0e01f8b344a29ce4c3a8a92a19a6-10"></a>    <span class="c1"># raise_exception = True</span>
</pre>
</div>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>
</html>
