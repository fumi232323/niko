<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
<title>Python のメモ/ふみのて</title>
<link rel="shortcut icon" href="../../assets/icons/favicon.ico">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Griffy">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Vollkorn:400,700">
<link rel="stylesheet" href="https://fonts.googleapis.com/earlyaccess/sawarabimincho.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
<link rel="stylesheet" href="../../assets/css/style.css?20190615">
</head>
<body>
    <div class="container">
      <div class="header"><header class="item item-header"><h1>
    <a href="../../">
      <img class="logo" src="../../assets/images/inuu.png" alt="犬"></a>
  </h1>
  <iframe src="../../tags/" class="tags"></iframe>
</header></div>
      <div class="main">
<div class="article-content">
  <main class="item item-article item-python"><time class="date" datetime="2019-04-20 00:00:00+09:00">
      2019-04-20 Sat
    </time><div class="title">Python のメモ</div>
    <div class="category">
      <a href="../../tags/python/">
          python
      </a>
    </div>
    <div class="text">
      <div>
<details><summary>目次</summary><div class="contents topic" id="id1">
<p class="topic-title first">目次</p>
<ul class="simple">
<li><a class="reference internal" href="#id2" id="id27">リファレンス</a></li>
<li>
<a class="reference internal" href="#http" id="id28">ローカルに HTTP サーバーを立てる</a><ul>
<li><a class="reference internal" href="#id6" id="id29">リファレンス</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#id7" id="id30">ユーザー定義例外</a><ul>
<li><a class="reference internal" href="#id8" id="id31">リファレンス</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#re-matchobject-groupdict" id="id32">re.MatchObject.groupdict</a><ul>
<li><a class="reference internal" href="#id10" id="id33">リファレンス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id11" id="id34">どんどん足してくやつ</a></li>
<li><a class="reference internal" href="#coding-utf-8" id="id35">coding: utf-8</a></li>
<li><a class="reference internal" href="#yield-dict-zip-columns-data" id="id36">yield dict(zip(columns, data))</a></li>
<li><a class="reference internal" href="#defaultdict" id="id37">defaultdict</a></li>
<li><a class="reference internal" href="#id14" id="id38">組み込み型と名前が被った場合</a></li>
<li>
<a class="reference internal" href="#sorted" id="id39">sorted</a><ul>
<li><a class="reference internal" href="#id15" id="id40">リファレンス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#all" id="id41">all()</a></li>
<li>
<a class="reference internal" href="#property" id="id42">@property</a><ul>
<li><a class="reference internal" href="#id17" id="id43">リファレンス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id18" id="id44">シーケンスのアンパッキング</a></li>
<li><a class="reference internal" href="#stringio-seek-0" id="id45">StringIO().seek(0)</a></li>
<li><a class="reference internal" href="#if-name-main" id="id46">if __name__ == "__main__"</a></li>
<li>
<a class="reference internal" href="#unicode-str" id="id47">unicode と str</a><ul>
<li><a class="reference internal" href="#id20" id="id48">リファレンス</a></li>
</ul>
</li>
<li>
<a class="reference internal" href="#id21" id="id49">バックスラッシュ感染症</a><ul>
<li><a class="reference internal" href="#id22" id="id50">リファレンス</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id24" id="id51">正規表現のグループ化機能</a></li>
<li><a class="reference internal" href="#id26" id="id52">長い正規表現を記述する方法</a></li>
</ul>
</div>
</details><div class="section" id="id2">
<h2><a class="toc-backref" href="#id27">リファレンス</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/ja/3/genindex.html">頭文字別索引:</a></li>
<li><a class="reference external" href="https://docs.python.org/ja/3/py-modindex.html">Pythonモジュール索引</a></li>
<li><a class="reference external" href="https://docs.python.org/ja/3/library/functions.html#built-in-functions">組み込み関数</a></li>
<li><a class="reference external" href="https://docs.python.org/ja/3/library/index.html">Python 標準ライブラリ</a></li>
</ul>
</div>
<div class="section" id="http">
<h2><a class="toc-backref" href="#id28">ローカルに HTTP サーバーを立てる</a></h2>
<pre class="code python"><a name="rest_code_f424904617264dbd984fff1f48e430a7-1"></a><span class="c1"># ポートを指定 (現在のディレクトリのファイルを提供)</span>
<a name="rest_code_f424904617264dbd984fff1f48e430a7-2"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="mi">8000</span>
<a name="rest_code_f424904617264dbd984fff1f48e430a7-3"></a><span class="c1"># バインドするアドレスを指定 (現在のディレクトリのファイルを提供)</span>
<a name="rest_code_f424904617264dbd984fff1f48e430a7-4"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="mi">8000</span> <span class="o">--</span><span class="n">bind</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span>
<a name="rest_code_f424904617264dbd984fff1f48e430a7-5"></a><span class="c1"># ファイルを提供するディレクトリを指定</span>
<a name="rest_code_f424904617264dbd984fff1f48e430a7-6"></a><span class="err">$</span> <span class="n">python</span> <span class="o">-</span><span class="n">m</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span> <span class="o">--</span><span class="n">directory</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span>
</pre>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#id29">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/http.server.html">http.server --- HTTP サーバ</a></p>
</div>
</div>
<div class="section" id="id7">
<h2><a class="toc-backref" href="#id30">ユーザー定義例外</a></h2>
<ul>
<li>
<p class="first">Exception クラスを、直接または間接的に継承する</p>
<ul>
<li>
<p class="first"><a class="reference external" href="https://docs.python.org/ja/3/library/exceptions.html#BaseException">https://docs.python.org/ja/3/library/exceptions.html#BaseException</a></p>
<pre class="literal-block">
全ての組み込み例外の基底クラスです。ユーザ定義の例外に直接継承されることは意図されていません (継承には Exception を使ってください)。
</pre>
</li>
</ul>
</li>
<li>
<p class="first">大抵は、いくつかの属性だけを提供し、例外が発生したときにハンドラがエラーに関する情報を取り出せるようにする程度にとどめる</p>
</li>
<li>
<p class="first">だいたいは、標準の例外の名前付けと同様に、 "Error" で終わる名前で定義する</p>
</li>
<li>
<p class="first">複数の別個の例外を送出するようなモジュールを作成する際には、そのモジュールで定義されている例外の基底クラスを作成するのが一般的なプラクティス</p>
</li>
</ul>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#id31">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/3.7/tutorial/errors.html#user-defined-exceptions">8.5. ユーザー定義例外</a></p>
</div>
</div>
<div class="section" id="re-matchobject-groupdict">
<h2><a class="toc-backref" href="#id32">re.MatchObject.groupdict</a></h2>
<ul class="simple">
<li>マッチの、すべての 名前つきの サブグループを含む、サブグループ名でキー付けされた辞書を返す</li>
<li>リファレンスのサンプルコードを見ると一目瞭然なので、そちらを見てください</li>
</ul>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#id33">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/2.7/library/re.html#re.MatchObject.groupdict">https://docs.python.org/ja/2.7/library/re.html#re.MatchObject.groupdict</a></p>
</div>
</div>
<div class="section" id="id11">
<h2><a class="toc-backref" href="#id34">どんどん足してくやつ</a></h2>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/ja/3/library/functools.html#functools.reduce">functools.reduce</a></li>
</ul>
</div>
<div class="section" id="coding-utf-8">
<h2><a class="toc-backref" href="#id35">coding: utf-8</a></h2>
<p>ソースコードの文字エンコーディングを指定する</p>
<pre class="code python"><a name="rest_code_3ed395f99a964378b18e43b01c0cd6e1-1"></a><span class="c1"># -*- coding: utf-8 -*-</span>
</pre>
<ul class="simple">
<li>ファイルの先頭に記述する</li>
<li>記述しないと、 Python2 環境かつファイルにマルチバイトが含まれていると <tt class="docutils literal">SyntaxError</tt> が発生する。</li>
<li>Python3 環境では不要</li>
</ul>
</div>
<div class="section" id="yield-dict-zip-columns-data">
<h2><a class="toc-backref" href="#id36">yield dict(zip(columns, data))</a></h2>
<p>これは、</p>
<pre class="code python"><a name="rest_code_05182536daf14d0f8f01a574d2b1e7c1-1"></a><span class="k">for</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<a name="rest_code_05182536daf14d0f8f01a574d2b1e7c1-2"></a>    <span class="n">row_dict</span><span class="p">[</span><span class="n">column</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<a name="rest_code_05182536daf14d0f8f01a574d2b1e7c1-3"></a>    <span class="k">yield</span> <span class="n">row_dict</span>
</pre>
<p>こう書ける。</p>
<pre class="code python"><a name="rest_code_a182196372444049a482569c5e70d05f-1"></a><span class="k">yield</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="p">,</span> <span class="n">data</span><span class="p">))</span>
</pre>
<ul>
<li>
<p class="first"><tt class="docutils literal">zip</tt> はタプルのイテレータを返す -&gt; タプルから辞書を作れる</p>
</li>
<li>
<p class="first"><tt class="docutils literal">dict(iterable, **kwarg)</tt></p>
</li>
<li>
<p class="first"><a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#dict">https://docs.python.org/ja/3/library/stdtypes.html#dict</a></p>
<pre class="literal-block">
それ以外の場合、位置引数は iterable オブジェクトでなければなりません。iterable のそれぞれの要素自身は、ちょうど 2 個のオブジェクトを持つイテラブルでなければなりません。それぞれの要素の最初のオブジェクトは新しい辞書のキーになり、2 番目のオブジェクトはそれに対応する値になります。同一のキーが 2 回以上現れた場合は、そのキーの最後の値が新しい辞書での対応する値になります。
</pre>
</li>
</ul>
</div>
<div class="section" id="defaultdict">
<h2><a class="toc-backref" href="#id37">defaultdict</a></h2>
<p>リストの初期化が不要になる！</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/ja/3/library/collections.html#defaultdict-objects">defaultdict オブジェクト</a></li>
<li><a class="reference external" href="https://docs.python.org/ja/3/library/collections.html#defaultdict-examples">defaultdict の使用例</a></li>
</ul>
</div>
<div class="section" id="id14">
<h2><a class="toc-backref" href="#id38">組み込み型と名前が被った場合</a></h2>
<p><tt class="docutils literal">in</tt> や <tt class="docutils literal">int</tt> など、キーワード・組み込み型と同じ名前を変数名にしたい場合は、末尾に <tt class="docutils literal">_</tt> を付ける。</p>
</div>
<div class="section" id="sorted">
<h2><a class="toc-backref" href="#id39">sorted</a></h2>
<p>これは、</p>
<pre class="code python"><a name="rest_code_6855065c14f3446cbe6ed2f43d5ef674-1"></a><span class="n">summary_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">summary_dict</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<a name="rest_code_6855065c14f3446cbe6ed2f43d5ef674-2"></a><span class="n">summary_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'sort_key'</span><span class="p">])</span>
</pre>
<p><tt class="docutils literal">sorted</tt> という関数を使って以下のように書ける。</p>
<pre class="code python"><a name="rest_code_fad0fecd1d474760af25d6bd7e7b3810-1"></a><span class="n">summary_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">summary_dict</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="s1">'sort_key'</span><span class="p">])</span>
</pre>
<p>さらに、for文をこんなふうに書くと <tt class="docutils literal">summary_list</tt> を作る工程が不要。</p>
<pre class="code python"><a name="rest_code_651a8c5a2c124482a59bae9502c24672-1"></a><span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">summary</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">summary_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
<a name="rest_code_651a8c5a2c124482a59bae9502c24672-2"></a>    <span class="o">....</span>
</pre>
<div class="section" id="id15">
<h3><a class="toc-backref" href="#id40">リファレンス</a></h3>
<p><cite>タプルはイミュータブルなシーケンス</cite> なので、 ソートできる。</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/ja/3/library/functions.html#sorted">sorted</a></li>
<li><a class="reference external" href="https://docs.python.org/ja/3/library/stdtypes.html#tuples">タプル型 (tuple)</a></li>
</ul>
</div>
</div>
<div class="section" id="all">
<h2><a class="toc-backref" href="#id41">all()</a></h2>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/functions.html#all">all(iterable)</a></p>
<ul class="simple">
<li>iterable の全ての要素が真ならば (もしくは iterable が空ならば) True を返す。</li>
</ul>
</div>
<div class="section" id="property">
<h2><a class="toc-backref" href="#id42">@property</a></h2>
<p><tt class="docutils literal">@property</tt> デコレータ を付けると、プロパティのように呼び出せる。</p>
<ul>
<li>
<p class="first">付け方</p>
<pre class="code python"><a name="rest_code_ff8afc7b63284bcfb44a1580c08a4baf-1"></a><span class="err">@</span> <span class="nb">property</span>
<a name="rest_code_ff8afc7b63284bcfb44a1580c08a4baf-2"></a><span class="k">def</span> <span class="nf">access_datehour</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_ff8afc7b63284bcfb44a1580c08a4baf-3"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">access_datetime</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y/%m/</span><span class="si">%d</span><span class="s1"> %H'</span><span class="p">)</span>
</pre>
</li>
<li>
<p class="first">呼び出すとき</p>
<pre class="code python"><a name="rest_code_f07f6be6caa4476aa049dbaa00daafce-1"></a><span class="n">xxx</span><span class="o">.</span><span class="n">access_datehour</span>
</pre>
</li>
</ul>
<div class="section" id="id17">
<h3><a class="toc-backref" href="#id43">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/functions.html#property">https://docs.python.org/ja/3/library/functions.html#property</a></p>
<ul class="simple">
<li>同じ名前のまま 読み出し専用属性の <tt class="docutils literal">getter</tt> にしてくれる</li>
</ul>
</div>
</div>
<div class="section" id="id18">
<h2><a class="toc-backref" href="#id44">シーケンスのアンパッキング</a></h2>
<p><a class="reference external" href="https://docs.python.org/ja/3/tutorial/datastructures.html#tuples-and-sequences">タプルとシーケンス</a></p>
</div>
<div class="section" id="stringio-seek-0">
<h2><a class="toc-backref" href="#id45">StringIO().seek(0)</a></h2>
<p><a class="reference external" href="https://docs.python.org/ja/3/library/io.html#io.IOBase.seek">https://docs.python.org/ja/3/library/io.html#io.IOBase.seek</a></p>
<ul class="simple">
<li>先頭にもどす、 (カーソルを先頭に戻すみたいなイメージ)</li>
</ul>
</div>
<div class="section" id="if-name-main">
<h2><a class="toc-backref" href="#id46">if __name__ == "__main__"</a></h2>
<p><a class="reference external" href="http://blog.pyq.jp/entry/Python_kaiketsu_180207">http://blog.pyq.jp/entry/Python_kaiketsu_180207</a></p>
<ul class="simple">
<li>Pythonでは、インポートされたファイルの中身は実行される</li>
</ul>
</div>
<div class="section" id="unicode-str">
<h2><a class="toc-backref" href="#id47">unicode と str</a></h2>
<pre class="code python"><a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-1"></a><span class="o">&gt;&gt;&gt;</span> <span class="c1"># -*- coding: utf-8 -*-</span>
<a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-2"></a><span class="o">&gt;&gt;&gt;</span> <span class="s1">'ふみ'</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">'ふみ'</span>
<a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-3"></a><span class="bp">False</span>
<a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-4"></a><span class="o">&gt;&gt;&gt;</span> <span class="s1">'fumi23'</span> <span class="o">==</span> <span class="sa">u</span><span class="s1">'fumi23'</span>
<a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-5"></a><span class="bp">True</span>
<a name="rest_code_f74f6f36c55140199e5bc29e54adc12a-6"></a><span class="o">&gt;&gt;&gt;</span>
</pre>
<ul class="simple">
<li>python2 の場合、マルチバイトを含むと <tt class="docutils literal">u</tt> の有無で違うオブジェクトとして判定される。</li>
<li>python2の文字には <tt class="docutils literal">unicode</tt> と <tt class="docutils literal">str</tt> がある。 ascii 文字しか含まない場合は 同じ値と判断されるけど基本的に別物として考えたほうがいい。</li>
</ul>
<div class="section" id="id20">
<h3><a class="toc-backref" href="#id48">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/2.7/tutorial/introduction.html#unicode-strings">3.1.3. Unicode 文字列</a></p>
</div>
</div>
<div class="section" id="id21">
<h2><a class="toc-backref" href="#id49">バックスラッシュ感染症</a></h2>
<p>こんなふうに書く</p>
<pre class="code python"><a name="rest_code_7b97f865cefc415188f37d9378b86dc9-1"></a><span class="sa">r</span><span class="s2">"ab*"</span>
</pre>
<div class="section" id="id22">
<h3><a class="toc-backref" href="#id50">リファレンス</a></h3>
<p><a class="reference external" href="https://docs.python.org/ja/3.7/howto/regex.html#the-backslash-plague">バックスラッシュ感染症</a></p>
<ul class="simple">
<li>
<tt class="docutils literal">r</tt> を文字列リテラルの先頭に書くことでバックスラッシュは特別扱いされなくなる</li>
<li>多くの場合 Python コードの中の正規表現はこの raw string 記法を使って書かれる</li>
</ul>
</div>
</div>
<div class="section" id="id24">
<h2><a class="toc-backref" href="#id51">正規表現のグループ化機能</a></h2>
<p>このあたりから</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/ja/3.7/howto/regex.html#non-capturing-and-named-groups">取り出さないグループと名前つきグループ</a></li>
</ul>
</div>
<div class="section" id="id26">
<h2><a class="toc-backref" href="#id52">長い正規表現を記述する方法</a></h2>
<ul class="simple">
<li>カンマ区切り無しで文字列リテラルを複数に分ける<ul>
<li><a class="reference external" href="http://docs.python-guide.org/en/latest/writing/style/#line-continuations">http://docs.python-guide.org/en/latest/writing/style/#line-continuations</a></li>
</ul>
</li>
<li>re.VERBOSE オプションを使う<ul>
<li><a class="reference external" href="https://docs.python.org/ja/3/library/re.html#re.VERBOSE">https://docs.python.org/ja/3/library/re.html#re.VERBOSE</a></li>
</ul>
</li>
</ul>
</div>
</div>
    </div>
  </main>
</div>
</div>
    </div>
  </body>
</html>
